{% extends 'inventory/importrecord_list.html' %}
{% load i18n %}
{% load thumbnail %}
{% load staticfiles %}
{% load sorting_tags %}
{% load form_tags %}
{% load underscore_tags %}

{% block headertext %}
    {{ title }}
    <p>
        <a href="{% url 'dashboard:catalogue-product' parent.id %}" class="btn btn-secondary">
            <i class="icon-arrow-left"></i>&nbsp;
            Return to Product
        </a>
        <a href="{% url 'dashboard:list_records' parent.id %}" class="btn btn-primary">
            <i class="icon-list"></i>&nbsp;
            List of Import Records
        </a>
    </p>
{% endblock %}

{% block dashboard_content %}
    <style type="text/css">
        table.normalize input, table.normalize div.controls  {
            width: auto !important;
            margin-left: 0px !important;
        }
        .align-right {
            text-align: right !important;
        }
    </style>
    <hr>
    <form method="post" action="." class="form-horizontal container">
        {% csrf_token %}

        {% if form.is_bound and not form.is_valid %}
            <div class="alert alert-error">
                <strong>{% trans "Oops! We found some errors" %}</strong> - {% trans "please check the error messages below and try again" %}
            </div>
        {% endif %}

        {% if form.non_field_errors %}
            {% for error in form.non_field_errors %}
                <div class="alert alert-error control-group error">
                    <span class="help-inline"><i class="icon-exclamation-sign"></i> {{ error }}</span>
                </div>
            {% endfor %}
        {% endif %}

        {{ form.id }}

        <!--Begin Custom Form Code -->
        <div class="row-fluid">
            <div class="span6">
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                <h3>Product Information</h3>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                {% include 'partials/form_field.html' with field=form.product %}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                {% include 'partials/form_field.html' with field=form.partner_sku %}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Our SKU - Not Implemented yet.
                            </td>
                        </tr>
                        <tr>
                            <td>
                                {% include 'partials/form_field.html' with field=form.quantity %}
                            </td>
                        </tr>   
                    </tbody>
                </table>
            </div>
            <div class="span6">
                <h1>Create New Import Stock Record</h1>
                <h2>{{ object.product }}</h2>
                {% include 'partials/form_field.html' with field=form.imported_date %}
            </div>
        </div>

        <div class="row-fluid">
            <div class="span12">
                <table class="table table-striped table-bordered normalize">
                    <thead>
                        <tr>
                            <th>Origin Currency</th>
                            <th>Std. Export Price ({{ object.origin_currency }})</th>
                            <th>Partner Discount (%)</th>
                            <th>Export Price</th>
                            <th>Currency Factor</th>
                            <th>Import Price (USD)</th>
                        </tr>                        
                    </thead>
                    <tbody>
                        <tr>
                            <td>{% include 'partials/form_field.html' with field=form.origin_currency nolabel=True %}</td>
                            <td>{% include 'partials/form_field.html' with field=form.standard_export_price nolabel=True %}</td>
                            <td>{% include 'partials/form_field.html' with field=form.partner_discount nolabel=True %}</td>
                            <td>{{ object.export_price }} {{ object.origin_currency }}</td>
                            <td>{% include 'partials/form_field.html' with field=form.currency_factor nolabel=True %}</td>
                            <td>${{ object.import_price }}</td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>

        <div class="row-fluid">
            <div class="span6">
                <table class="table table-bordered table-striped normalize">
                    <thead>
                        <tr>
                            <th>Tariff Code</th>
                            <th>Tariff Rate</th>
                            <th>Tariff Cost (USD)</th>
                        </tr>                        
                    </thead>
                    <tbody>
                        <tr>
                            <td>{% include 'partials/form_field.html' with field=form.tariff_code nolabel=True %}</td>
                            <td>{% include 'partials/form_field.html' with field=form.tariff_rate nolabel=True %}</td>
                            <td>${{ object.tariff }}</td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                NOTE: Add Tariff Code Feature Here.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="span6">
                <table class="table table-bordered table-striped normalize">
                    <thead>
                        <tr>
                            <th>Shipping Weight</th>
                            <th>Shipping Factor</th>
                            <th>Cost</th>
                            <th>Manual Cost (USD)</th>
                        </tr>                        
                    </thead>
                    <tbody>
                        <tr>
                            <td>{% include 'partials/form_field.html' with field=form.shipping_weight nolabel=True %}</td>
                            <td>{% include 'partials/form_field.html' with field=form.shipping_factor nolabel=True %}</td>
                            <td>${{ object.shipping_cost }}</td>
                            <td>{% include 'partials/form_field.html' with field=form|field_:'_shipping_cost' nolabel=True %}</td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                NOTE: Enter Shipping Weight &amp; Factor OR manually enter COST
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row-fluid">
            <div class="span12">
                <table class="table table-striped table-bordered normalize">
                    <thead>
                        <tr>
                            <th>Import Cost</th>
                            <th>Cost Price</th>
                            <th>Origin MSRP ({{ object.origin_currency }})</th>
                            <th>MSRP</th>
                            <th>Target WS GPM (%)</th>
                            <th>Target WS Price</th>
                            <th>Target Retail Factor</th>
                            <th>Implied MSRP</th>
                            <th>MSRP Delta</th>
                            <th>MSRP Markup</th>
                        </tr>                        
                    </thead>
                    <tbody>
                        <tr>
                            <td>${{ object.import_cost }}</td>
                            <td>${{ object.cost_price }}</td>
                            <td>{% include 'partials/form_field.html' with field=form.origin_msrp nolabel=True %}</td>
                            <td>${{ object.msrp }}</td>
                            <td>{% include 'partials/form_field.html' with field=form.target_wholesale_gpm nolabel=True %}</td>
                            <td>${{ object.target_wholesale_price }}</td>
                            <td>{% include 'partials/form_field.html' with field=form.target_retail_factor nolabel=True %}</td>
                            <td>${{ object.implied_msrp }}</td>
                            <td>${{ object.msrp_delta }}</td>
                            <td>{{ object.msrp_markup }}%</td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>

        <div class="row-fluid">
            <div class="span12">
                <table class="table table-striped table-bordered normalize">
                    <thead>
                        <tr>
                            <th>WS Price</th>
                            <th>WS Profit</th>
                            <th>WS GPM</th>
                            <th>Retail Price</th>
                            <th>Retail Profit</th>
                            <th>Retail GPM</th>
                            <th>Reseller's Profit</th>
                            <th>Reseller's GPM</th>
                        </tr>                        
                    </thead>
                    <tbody>
                        <tr>
                            <td>${{ object.price_reseller }}</td>
                            <td>${{ object.wholesale_profit }}</td>
                            <td>{{ object.wholesale_gpm }}%</td>
                            <td>${{ object.price_retail }}</td>
                            <td>${{ object.retail_profit }}</td>
                            <td>{{ object.retail_gpm }}%</td>
                            <td>${{ object.reseller_profit }}</td>
                            <td>{{ object.reseller_gpm }}%</td>
                        </tr>
                        <tr>
                            <td colspan="2" class="align-right">
                                Manually Override Wholesale Price (${{ object.price_reseller }}):
                            </td>
                            <td colspan="2">
                                {% include 'partials/form_field.html' with field=form|field_:'_price_reseller' nolabel=True %}
                            </td>
                            <td colspan="2" class="align-right">
                                Manually Override Retail Price (${{ object.price_retail }}):
                            </td>
                            <td colspan="2">
                                {% include 'partials/form_field.html' with field=form|field_:'_price_retail' nolabel=True %}
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>

        <div class="form-action">
            <button class="btn btn-primary btn-large" type="submit">Submit Record</button>
        </div>
    </form>

{% endblock %}

 {% block extrascripts %}
    {{ block.super }}
    <script type="text/javascript">
        var IMPORT_RECORD_PAGE = 'create';
        var record_list = {
            {% for record in stock_records %}
                "{{ record.product.id }}" : "{{ record.partner_sku }}",
            {% endfor %}
            "end": ""
        };
    </script>
    <script type="text/javascript" src="{% static 'js/import_records.js' %}"></script>
{% endblock %}